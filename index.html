<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Commande de Vêtements Scolaires</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .form-container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        #studentName {
            font-size: 18px;
            padding: 12px;
            border: 2px solid #4CAF50;
            border-radius: 6px;
            transition: all 0.3s ease;
            background-color: #f8f8f8;
        }
        #studentName:focus {
            border-color: #2196F3;
            box-shadow: 0 0 8px rgba(33, 150, 243, 0.3);
            background-color: white;
        }
        .logo-options {
            margin-top: 10px;
        }
        .logo-option {
            display: block;
            margin-bottom: 10px;
            cursor: pointer;
        }
        .logo-option input[type="radio"] {
            margin-right: 8px;
        }
        .logo-option label {
            display: inline;
            font-weight: normal;
            color: #333;
        }
        .logo-option:hover label {
            color: #4CAF50;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        .total-section {
            margin-top: 20px;
            padding: 15px;
            background-color: #e9e9e9;
            border-radius: 4px;
        }
        .item-container {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
            position: relative;
            background-color: white;
        }
        .remove-item {
            background-color: #ff4444;
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
        }
        .remove-item:hover {
            background-color: #cc0000;
        }
        .add-item-btn {
            background-color: #2196F3;
            margin-bottom: 20px;
        }
        .add-item-btn:hover {
            background-color: #0b7dda;
        }
        .logo-version-blanc {
            background-color: #333;
        }
        .logo-version-noir {
            background-color: #fff;
        }
    </style>
</head>
<body>
    <div class="form-container">
        <h1>Commande de Vêtements Scolaires</h1>
        <form id="orderForm">
            <div class="form-group">
                <label for="studentName">Nom de l'étudiant:</label>
                <input type="text" id="studentName" name="studentName" required>
            </div>

            <div id="items-container">
                <div class="item-container" data-item-id="1">
                    <button type="button" class="remove-item" onclick="removeItem(this)" style="display: none;">Supprimer</button>
                    
                    <div class="form-group">
                        <label for="description-1">Description du vêtement:</label>
                        <select id="description-1" name="description" required>
                            <option value="">Sélectionnez un type</option>
                            <option value="T-Shirt">T-Shirt</option>
                            <option value="T-Shirt Manches Longes">T-Shirt Manches Longes</option>
                            <option value="Crewneck">Crewneck</option>
                            <option value="Coton ouaté">Coton ouaté</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="color-1">Couleur:</label>
                        <input type="text" id="color-1" name="color" required>
                    </div>

                    <div class="form-group">
                        <label for="size-1">Grandeur:</label>
                        <select id="size-1" name="size" required>
                            <option value="">Sélectionnez une taille</option>
                            <option value="XS">XS</option>
                            <option value="S">S</option>
                            <option value="M">M</option>
                            <option value="L">L</option>
                            <option value="XL">XL</option>
                            <option value="XXL">XXL</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="price-1">Prix:</label>
                        <input type="number" id="price-1" name="price" step="0.01" required onchange="updateTotal()">
                    </div>

                    <div class="form-group">
                        <label>Choix du logo:</label>
                        <div class="logo-options">
                            <div class="logo-option">
                                <input type="radio" name="logo-1" value="original" id="logo-original-1" required>
                                <label for="logo-original-1">Logo Original</label>
                            </div>
                            <div class="logo-option">
                                <input type="radio" name="logo-1" value="blanc" id="logo-blanc-1">
                                <label for="logo-blanc-1">Logo Version Blanche</label>
                            </div>
                            <div class="logo-option">
                                <input type="radio" name="logo-1" value="noir" id="logo-noir-1">
                                <label for="logo-noir-1">Logo Version Noire</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <button type="button" class="add-item-btn" onclick="addItem()">Ajouter un article</button>

            <div class="total-section">
                <p>Rabais par étudiant: 5$</p>
                <p>Prix avant rabais: <span id="originalPrice">0.00</span>$</p>
                <p>Prix total (avec rabais): <span id="totalPrice">0.00</span>$</p>
            </div>

            <button type="submit">Soumettre la commande</button>
        </form>
    </div>

    <script>
        let itemCounter = 1;
        const lightColors = [
            '#e8f4ff', // Light blue
            '#f0fff0', // Light green
            '#fff0f5', // Lavender blush
            '#f0f8ff', // Alice blue
            '#fff5e6', // Light orange
            '#f5f0ff', // Light purple
            '#ffe6e6', // Light red
            '#f0ffff'  // Light cyan
        ];

        function addItem() {
            itemCounter++;
            const container = document.getElementById('items-container');
            const newItem = document.createElement('div');
            newItem.className = 'item-container';
            newItem.dataset.itemId = itemCounter;
            // Set background color based on item count (cycling through colors)
            newItem.style.backgroundColor = lightColors[(itemCounter - 1) % lightColors.length];

            newItem.innerHTML = `
                <button type="button" class="remove-item" onclick="removeItem(this)">Supprimer</button>
                
                <div class="form-group">
                    <label for="description-${itemCounter}">Description du vêtement:</label>
                    <select id="description-${itemCounter}" name="description" required>
                        <option value="">Sélectionnez un type</option>
                        <option value="T-Shirt">T-Shirt</option>
                        <option value="T-Shirt Manches Longes">T-Shirt Manches Longes</option>
                        <option value="Crewneck">Crewneck</option>
                        <option value="Coton ouaté">Coton ouaté</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="color-${itemCounter}">Couleur:</label>
                    <input type="text" id="color-${itemCounter}" name="color" required>
                </div>

                <div class="form-group">
                    <label for="size-${itemCounter}">Grandeur:</label>
                    <select id="size-${itemCounter}" name="size" required>
                        <option value="">Sélectionnez une taille</option>
                        <option value="XS">XS</option>
                        <option value="S">S</option>
                        <option value="M">M</option>
                        <option value="L">L</option>
                        <option value="XL">XL</option>
                        <option value="XXL">XXL</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="price-${itemCounter}">Prix:</label>
                    <input type="number" id="price-${itemCounter}" name="price" step="0.01" required onchange="updateTotal()">
                </div>

                <div class="form-group">
                    <label>Choix du logo:</label>
                    <div class="logo-options">
                        <div class="logo-option">
                            <input type="radio" name="logo-${itemCounter}" value="original" id="logo-original-${itemCounter}" required>
                            <label for="logo-original-${itemCounter}">Logo Original</label>
                        </div>
                        <div class="logo-option">
                            <input type="radio" name="logo-${itemCounter}" value="blanc" id="logo-blanc-${itemCounter}">
                            <label for="logo-blanc-${itemCounter}">Logo Version Blanche</label>
                        </div>
                        <div class="logo-option">
                            <input type="radio" name="logo-${itemCounter}" value="noir" id="logo-noir-${itemCounter}">
                            <label for="logo-noir-${itemCounter}">Logo Version Noire</label>
                        </div>
                    </div>
                </div>
            `;

            container.appendChild(newItem);
            updateRemoveButtons();
        }

        function removeItem(button) {
            button.closest('.item-container').remove();
            updateRemoveButtons();
            updateTotal();
        }

        function updateRemoveButtons() {
            const items = document.querySelectorAll('.item-container');
            items.forEach(item => {
                const removeBtn = item.querySelector('.remove-item');
                removeBtn.style.display = items.length > 1 ? 'block' : 'none';
            });
        }

        function updateTotal() {
            const priceInputs = document.querySelectorAll('input[name="price"]');
            let totalPrice = 0;
            
            priceInputs.forEach(input => {
                totalPrice += parseFloat(input.value) || 0;
            });
            
            const discount = 5;
            
            document.getElementById('originalPrice').textContent = totalPrice.toFixed(2);
            document.getElementById('totalPrice').textContent = (totalPrice - discount).toFixed(2);
        }

        document.getElementById('orderForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const items = document.querySelectorAll('.item-container');
            const studentName = document.getElementById('studentName').value;
            const originalPrice = document.getElementById('originalPrice').textContent;
            const totalPrice = document.getElementById('totalPrice').textContent;
            
            // Validate all required fields
            let isValid = true;
            let missingFields = [];

            if (!studentName) {
                isValid = false;
                missingFields.push('Nom de l\'étudiant');
            }

            items.forEach((item, index) => {
                const itemId = item.dataset.itemId;
                const fields = {
                    'Description du vêtement': document.getElementById(`description-${itemId}`).value,
                    'Couleur': document.getElementById(`color-${itemId}`).value,
                    'Grandeur': document.getElementById(`size-${itemId}`).value,
                    'Prix': document.getElementById(`price-${itemId}`).value,
                    'Logo': document.querySelector(`input[name="logo-${itemId}"]:checked`)?.value
                };

                Object.entries(fields).forEach(([key, value]) => {
                    if (!value) {
                        isValid = false;
                        missingFields.push(`${key} (Article ${index + 1})`);
                    }
                });
            });

            if (!isValid) {
                alert('Veuillez remplir tous les champs obligatoires:\n' + missingFields.join('\n'));
                return;
            }

            try {
                const submitButton = document.querySelector('button[type="submit"]');
                submitButton.disabled = true;
                submitButton.textContent = 'Envoi en cours...';

                // Send each item as a separate row
                for (const item of items) {
                    const itemId = item.dataset.itemId;
                    const itemData = {
                        studentName: studentName,
                        description: document.getElementById(`description-${itemId}`).value,
                        color: document.getElementById(`color-${itemId}`).value,
                        size: document.getElementById(`size-${itemId}`).value,
                        price: document.getElementById(`price-${itemId}`).value,
                        logo: document.querySelector(`input[name="logo-${itemId}"]:checked`).value,
                        originalPrice: originalPrice,
                        totalPrice: totalPrice
                    };

                    await fetch('https://script.google.com/macros/s/AKfycbwriJmKk93NW5To1Q3_A5c9XYtkFFjGaKN261Qrz0xVHIif6jHDDU5tBQpFM8u5kPtK/exec', {
                        method: 'POST',
                        body: JSON.stringify(itemData),
                        mode: 'no-cors',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                }

                alert('Commande soumise avec succès! Les détails ont été enregistrés.');
                this.reset();
                // Reset to one item
                const container = document.getElementById('items-container');
                container.innerHTML = '';
                itemCounter = 0;
                addItem();
                // Set first item background to white
                document.querySelector('.item-container').style.backgroundColor = 'white';
                updateTotal();
            } catch (error) {
                console.error('Error:', error);
                alert('Erreur lors de la soumission. Veuillez réessayer.');
            } finally {
                const submitButton = document.querySelector('button[type="submit"]');
                submitButton.disabled = false;
                submitButton.textContent = 'Soumettre la commande';
            }
        });

        // Initialize the form
        updateRemoveButtons();
    </script>
</body>
</html>